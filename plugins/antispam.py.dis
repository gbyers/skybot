from util import hook
import time, re

#@hook.event('PRIVMSG')
def _privmsg(inp, input=None, conn=None):
    chan = input.chan.lower()
    nick = input.nick.lower()
    if not privmsg.has_key(chan):
        privmsg[chan] = {}
    if not privmsg[chan].has_key(nick):
        privmsg[chan][nick] = {"count": 1, "last": time.time(), "kicked": 0, "iskicked": 0}
    else:
        c = privmsg[chan][nick]["count"]
        l = privmsg[chan][nick]["last"]
        c = c+1-int(time.time() - l)
        if c < 0: c = 0
        privmsg[chan][nick]["count"] = c
        privmsg[chan][nick]["last"] = time.time()
        #if c >= 3 and privmsg[chan][nick]["kicked"] <= 2 and privmsg[chan][nick]["iskicked"] == 0:
        if c >= 3:
            conn.cmd("KICK %s %s :Don't spam"%(chan,nick))
            #privmsg[chan][nick]["kicked"] = privmsg[chan][nick]["kicked"]+1
            #privmsg[chan][nick]["iskicked"] = 1
        #elif c >= 2 and privmsg[chan][nick]["kicked"] >= 3 and privmsg[chan][nick]["iskicked"] == 0:
        #    conn.cmd("MODE %s +b %s!*@%s.*"%(chan,nick,input.host.split(".",2)[-3]))
        #    privmsg[chan][nick]["kicked"] = 0
        #    privmsg[chan][nick]["iskicked"] = 0
        #elif c >= 5:
        #    conn.cmd("MODE %s +b %s!*@%s.*"%(chan,nick,input.host.split(".",2)[-3]))
        #    privmsg[chan][nick]["iskicked"] = 0
